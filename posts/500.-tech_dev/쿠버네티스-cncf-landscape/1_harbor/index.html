<!doctype html><html lang=en><head><title>Harbor</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.a645a51ce96fb50237bbc1963357f13368de2c1e10aa221b68ef773965e2a474.css integrity="sha256-pkWlHOlvtQI3u8GWM1fxM2jeLB4QqiIbaO93OWXipHQ="><meta property="og:title" content="양성연의 블로그"><meta property="og:type" content="website"><meta property="og:description" content><meta property="og:image" content="/images/default-avatar.jpeg"><meta property="og:url" content="https://kubesy.com/"><meta name=description content="컨테이너 레지스트리 프로젝트 : Harbor"><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/>양성연의 블로그</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#education>Education</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#recent-posts>Recent Posts</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/100.-diary/ title="100. Diary">100. Diary</a></li><li><a class=list-link href=/posts/200.-novel/ title="200. Novel">200. Novel</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/300.-study/> 300. Study</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/300.-study/301.-kubernetes-deep-dive/> 301. Kubernetes deep-dive!</a><ul><li><a class=list-link href=/posts/300.-study/301.-kubernetes-deep-dive/hello-k8s-dev-world/ title="1. Hello, k8s Dev World!">1. Hello, k8s Dev World!</a></li></ul></li><li><a class=list-link href=/posts/300.-study/302.-openstack-deep-dive/ title="302. OpenStack deep-dive!">302. OpenStack deep-dive!</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/300.-study/303.-java-spring-boot-/> 303. Java Spring Boot</a><ul><li><a class=list-link href=/posts/300.-study/303.-java-spring-boot-/1.-%EA%B0%9C%EB%85%90-%EB%B0%8F-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EA%B0%84%EB%8B%A8%ED%95%9C-%EA%B5%AC%EB%8F%99/ title="1. 개념 및 환경 구축 그리고 간단한 구동">1. 개념 및 환경 구축 그리고 간단한 구동</a></li></ul></li></ul></li><li><a class=list-link href=/posts/400.-project/ title="400. Project">400. Project</a></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/500.-tech_dev/> 500. Tech & Dev</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C-%EA%B0%9C%EB%B0%9C/> K8s Native Development</a><ul><li><a class=list-link href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C-%EA%B0%9C%EB%B0%9C/operator-framework/ title="k8s operator 패턴 구현 (Operator Framework)">k8s operator 패턴 구현 (Operator Framework)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B8%B0%EB%B3%B8/> 쿠버네티스가 뭐지</a><ul><li><a class=list-link href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B8%B0%EB%B3%B8/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EA%B0%80-%EB%AD%90%EC%A7%80/ title="쿠버네티스가 뭐지 1">쿠버네티스가 뭐지 1</a></li><li><a class=list-link href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B8%B0%EB%B3%B8/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EA%B0%80-%EB%AD%90%EC%A7%802/ title="쿠버네티스가 뭐지 2">쿠버네티스가 뭐지 2</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-cncf-landscape/> K8s CNCF Landscape</a><ul class=active><li><a class="active list-link" href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-cncf-landscape/1_harbor/ title=Harbor>Harbor</a></li></ul></li><li><a class=list-link href=/posts/500.-tech_dev/kolla-ansible/ title=Kolla-Ansible>Kolla-Ansible</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/500.-tech_dev/%EA%B8%B0%ED%83%80/> etc</a><ul><li><a class=list-link href=/posts/500.-tech_dev/%EA%B8%B0%ED%83%80/%EA%B8%B0%EC%88%A0-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EC%9C%A0%EC%A7%80%EB%B3%B4%EC%88%98/ title="방치해두었던 hugo 블로그 최신화 경험">방치해두었던 hugo 블로그 최신화 경험</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/hero/harbor.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/default-avatar_hu_403664f4887f3130.jpeg alt="Author Image"><h5 class=author-name>Seong-Yeon Yang</h5><p class=text-muted>Sunday, July 31, 2022</p></div><div class=title><h1>Harbor</h1></div><div class=post-content id=post-content><h1 id=harbor>Harbor</h1><img src=/posts/images/cncf/harbor/0.png class=center><ul><li><p>참고자료</p><p><a href=https://happycloud-lee.tistory.com/165 target=_blank rel=noopener>https://happycloud-lee.tistory.com/165</a></p><p><a href=https://goharbor.io/docs/2.1.0/install-config/ target=_blank rel=noopener>https://goharbor.io/docs/2.1.0/install-config/</a></p></li></ul><p>쿠버네티스에서 파드를 생성할 때 필수적으로 필요로 하는 것이 바로 컨테이너 이미지 입니다. 컨테이너 이미지는 로컬에 저장할 수도 있고 <a href=https://hub.docker.com target=_blank rel=noopener>도커 허브</a>와 같은 원격 환경을 이용할 수도 있습니다. 원격 환경이 다른 사람들에게 이미지를 공유하거나 할 때 편리하지만, 문제는 도커 허브 이용에 제한이 생겼다는 것 입니다. 특정 시간 동안 특정 횟수의 다운로드 제한이 있습니다.</p><p>유료 모델을 사용하는 것도 하나의 방법이지만, 그보다 무료 이미지 저장소를 로컬에 설치 하는 것이 더 바람직할 듯 합니다. Harbor는 그 목적에 아주 적합 합니다.</p><h3 id=installation>Installation</h3><p>쿠버네티스에서 HA하게 하버를 이용하기 위해, <a href=https://goharbor.io/docs/2.8.0/install-config/harbor-ha-helm/ target=_blank rel=noopener>Helm을 통해 설치</a>하는 것 권장하고 있습니다.</p><p>미리 준비 해두어야 할 조건은 다음과 같습니다.</p><ul><li>Kubernetes cluster 1.10+ ⇒ 이번 테스트에서는 1.27 버전을 사용하고 있습니다.</li><li>Helm 2.8.0+ ⇒ Helm 3을 사용하고 있습니다.</li><li>High available ingress controller (Harbor does not manage the external endpoint) ⇒ 노드 포트를 사용할 수 있습니다. nginx 인그레스 컨트롤러 앞에 proxy를 붙혔을 때 왠지 모를 ssl 인증오류가 생겨서, 노드 포트를 열고 이를 proxy에 등록해줄 것 입니다.</li><li>High available PostgreSQL 9.6+ (Harbor does not handle the deployment of HA of database) ⇒ 파드로 만들어 놓아야 하는 걸까요?</li><li>High available Redis (Harbor does not handle the deployment of HA of Redis) ⇒ 위와 동일한 질문이 있습니다. 답을 먼저 말씀 드리자면, 꼭 미리 준비해 둘 필요는 없습니다.</li><li>PVC that can be shared across nodes or external object storage ⇒ 준비 된 PVC가 필요한데, 저희는 동적 프로비저닝 기능을 사용할 것입니다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 헬름 리포를 등록하고, 폴더를 내려 받습니다.</span>
</span></span><span style=display:flex><span>helm repo add harbor https://helm.goharbor.io
</span></span><span style=display:flex><span>helm fetch harbor/harbor --untar
</span></span></code></pre></div><p>명령어 실행한 경로에 <code>/harbor</code> 폴더가 생성되어 있습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cd ./harbor &amp;&amp; ls -al</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rwxr-xr-x   <span style=color:#ae81ff>4</span> root root    <span style=color:#ae81ff>123</span>  7월 <span style=color:#ae81ff>31</span> 18:03 .
</span></span><span style=display:flex><span>dr-xr-x---. <span style=color:#ae81ff>64</span> root root   <span style=color:#ae81ff>4096</span>  7월 <span style=color:#ae81ff>31</span> 18:03 ..
</span></span><span style=display:flex><span>-rw-r--r--   <span style=color:#ae81ff>1</span> root root     <span style=color:#ae81ff>57</span>  7월 <span style=color:#ae81ff>31</span> 18:03 .helmignore
</span></span><span style=display:flex><span>-rw-r--r--   <span style=color:#ae81ff>1</span> root root    <span style=color:#ae81ff>567</span>  7월 <span style=color:#ae81ff>31</span> 18:03 Chart.yaml
</span></span><span style=display:flex><span>-rw-r--r--   <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>11357</span>  7월 <span style=color:#ae81ff>31</span> 18:03 LICENSE
</span></span><span style=display:flex><span>-rw-r--r--   <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>192242</span>  7월 <span style=color:#ae81ff>31</span> 18:03 README.md
</span></span><span style=display:flex><span>drwxr-xr-x   <span style=color:#ae81ff>2</span> root root     <span style=color:#ae81ff>58</span>  7월 <span style=color:#ae81ff>31</span> 18:03 conf
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#ae81ff>15</span> root root   <span style=color:#ae81ff>4096</span>  7월 <span style=color:#ae81ff>31</span> 18:03 templates
</span></span><span style=display:flex><span>-rw-r--r--   <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>33874</span>  7월 <span style=color:#ae81ff>31</span> 18:03 values.yaml
</span></span></code></pre></div><p><code>values.yaml</code> 파일을 수정해야 합니다. <strong>Ingress rule</strong>, <strong>External URL</strong>, <strong>External PostgreSQL</strong>, <strong>External Redis,</strong> <strong>Storage</strong> 부분들에 변화가 필요하다고 합니다. 허나, 위에서 언급했듯 저는 PostgreSQL와 Redis도 내부 저장소 사용할 예정입니다. 결국 따로 필요로 하는 것은 Storage 설정입니다.</p><h4 id=dynamic-provisioning--pvc-with-nfs>Dynamic provisioning : pvc with NFS</h4><p>기본적인 PV / PVC 사용 순서는 미리 PV를 만들어 놓고, &ldquo;저 PV를 쓸거야"라는 선언의 목적으로 PVC를 만들어 놓아야 합니다. 하지만 동적 프로비저닝을 사용하면 PVC 하나만 적용시켜도 자동으로 PV가 생성되게 됩니다. 참고로 설치에 사용한 볼륨은 13G 정도 입니다.</p><ol><li><p>NFS 서버 시작하기</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># nfs-server를 다운 받습니다.</span>
</span></span><span style=display:flex><span>systemctl start nfs-server
</span></span><span style=display:flex><span>systemctl enable nfs-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># nfs 저장소로 사용할 폴더를 생성해 줍니다.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 경로는 자유입니다. 저는 nfs 폴더를 생성하였습니다.</span>
</span></span><span style=display:flex><span>mkdir nfs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/exports 파일에 경로를 등록합니다.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [path] = 파일 경로</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [cidr] = ex) 192.168.15.0/24 </span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;[path] [cidr](rw,sync,no_root_squash)&#39;</span> &gt;&gt; /etc/exports
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#설정을 적용하고 결과를 확인합니다.</span>
</span></span><span style=display:flex><span>exportfs -r
</span></span><span style=display:flex><span>showmount -e
</span></span></code></pre></div></li><li><p>동적 프로비저닝 설정하기</p><p>참고자료 → <a href=https://nayoungs.tistory.com/entry/Kubernetes-k8s-Volume-%eb%8f%99%ec%a0%81-%ed%94%84%eb%a1%9c%eb%b9%84%ec%a0%80%eb%8b%9d-with-NFS-%ea%b8%b0%eb%b3%b8-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%ed%81%b4%eb%9e%98%ec%8a%a4 target=_blank rel=noopener>Kubernetes k8s Volume 동적 프로비저닝 with NFS 기본 스토리지 클래스</a></p><p>⇒ 쿠버네티스 노드 모두에 nfs 클라이언트를 받아놓아야합니다.
위의 블로그에 과정이 자세하게 나와 있습니다. 굳이 디폴트 스토리지 클래스 까지 등록해주실 필요는 없습니다.</p><p>궁금한 점 중 하나는 <a href=https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner target=_blank rel=noopener>깃허브</a> 사이트에 보면 헬름으로도 이를 만들어줄 수 있는 듯 한데, 만약 여러 경로를 사용하려면, 여러 번 헬름 install을 수행하면 되는 것인가,, 라는 생각이 듭니다.</p></li></ol><h4 id=valuesyaml>values.yaml</h4><p><code>/harbor</code> 경로에 있는 폴더에 들어가보면 <code>values.yaml</code> 이라는 파일이 존재합니다. 하버 뿐만이 아니라, 여러 헬름 프로젝트에서는 설치에 필요한 각종 정보들은 위의 파일로 관리 합니다.</p><p>파일을 열어보면 1000줄 가까이의 무지막지한 라인들이 저를 반겨줍니다. 이 설정들을 하나하나 뜯어봐야하는 공포에 사로잡히지만, 다행이 수정할 부분은 그리 많지 않습니다.</p><p>가장 먼저 expose.type을 nodePort로 바꿔봅시다. 인그레스를 활용한 케이스는 <a href=https://velog.io/@wkfwktka/k8s%ec%9c%84%ec%97%90%ec%84%9c-Harbor-%ec%84%a4%ec%a0%95ingress-Helm target=_blank rel=noopener>이 블로그</a>를 살펴보시면 좋을 것 같습니다. 저도 처음에 nginx ingress 컨트롤러에 연결해 보았다가, 프록시와의 이유 모를 통신 이슈로 nodePort로 선회 했습니다.</p><p>인그레스 이외의 설정(&ldquo;clusterIP&rdquo;, &ldquo;nodePort&rdquo; or &ldquo;loadBalancer&rdquo;)을 사용한다면, tls 인증을 위해 expose.tls.auto.commonName을 입력해 줍시다. 저는 프록시에서 사용할 도메인을 입력해 주었습니다. tls 인증이 harbor CA 라는 곳에서 이뤄지던데, 정확이 어떤 곳인지는 잘 모르겠습니다.</p><p>또한 externalURL 쪽에도 https://[domain]을 입력해 주었습니다.</p><p>그 다음 볼륨 설정이 필요합니다. persistence.persistentVolumeClaim 쪽에서 registry, jobservice, database, redis, trivy 부분 아래 공통적으로 storageClass을 동적 프로비저닝 스토리지의 클래스로 지정해줘야 합니다.</p><p>설정이 끝났습니다.</p><h4 id=helm-install>Helm install</h4><p>helm을 이용한 설치는 언제나 편리합니다. 다만, 명령어 실행 부분이 harbor 폴더를 바라보고 있어야 합니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 네임스페이스 생성</span>
</span></span><span style=display:flex><span>kubectl create namespace harbor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># harbor 네임스페이스에 harbor 폴더의 설정 파일을 이용해 harbor를 설치</span>
</span></span><span style=display:flex><span>helm install -n harbor harbor harbor/
</span></span></code></pre></div><p>설정이 바뀌었을 때 적용 방법입니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade -n harbor harbor harbor/
</span></span></code></pre></div><p>설치를 확인 해봅시다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ k get all,pv,pvc -n harbor 
</span></span><span style=display:flex><span>NAME                                        READY   STATUS    RESTARTS       AGE
</span></span><span style=display:flex><span>pod/harbor-core-7db5b74c86-nctk2            1/1     Running   <span style=color:#ae81ff>0</span>              148m
</span></span><span style=display:flex><span>pod/harbor-database-0                       1/1     Running   <span style=color:#ae81ff>0</span>              15h
</span></span><span style=display:flex><span>pod/harbor-jobservice-865b66687b-mg9dr      1/1     Running   <span style=color:#ae81ff>3</span> <span style=color:#f92672>(</span>148m ago<span style=color:#f92672>)</span>   148m
</span></span><span style=display:flex><span>pod/harbor-nginx-5cb465f58f-fmmrz           1/1     Running   <span style=color:#ae81ff>0</span>              148m
</span></span><span style=display:flex><span>pod/harbor-notary-server-854944cd7d-kvsnf   1/1     Running   <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>143m ago<span style=color:#f92672>)</span>   148m
</span></span><span style=display:flex><span>pod/harbor-notary-signer-76b6978d97-h7gfl   1/1     Running   <span style=color:#ae81ff>0</span>              148m
</span></span><span style=display:flex><span>pod/harbor-portal-d7dbcc46c-94rxr           1/1     Running   <span style=color:#ae81ff>0</span>              15h
</span></span><span style=display:flex><span>pod/harbor-redis-0                          1/1     Running   <span style=color:#ae81ff>0</span>              15h
</span></span><span style=display:flex><span>pod/harbor-registry-d7c5dbf6f-7pzxc         2/2     Running   <span style=color:#ae81ff>0</span>              148m
</span></span><span style=display:flex><span>pod/harbor-trivy-0                          1/1     Running   <span style=color:#ae81ff>0</span>              15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>                                     AGE
</span></span><span style=display:flex><span>service/harbor                 NodePort    10.96.115.165    &lt;none&gt;        80:30002/TCP,443:30003/TCP,4443:30004/TCP   148m
</span></span><span style=display:flex><span>service/harbor-core            ClusterIP   10.96.117.194    &lt;none&gt;        80/TCP                                      15h
</span></span><span style=display:flex><span>service/harbor-database        ClusterIP   10.104.0.73      &lt;none&gt;        5432/TCP                                    15h
</span></span><span style=display:flex><span>service/harbor-jobservice      ClusterIP   10.102.37.222    &lt;none&gt;        80/TCP                                      15h
</span></span><span style=display:flex><span>service/harbor-notary-server   ClusterIP   10.108.64.69     &lt;none&gt;        4443/TCP                                    15h
</span></span><span style=display:flex><span>service/harbor-notary-signer   ClusterIP   10.111.161.104   &lt;none&gt;        7899/TCP                                    15h
</span></span><span style=display:flex><span>service/harbor-portal          ClusterIP   10.101.185.44    &lt;none&gt;        80/TCP                                      15h
</span></span><span style=display:flex><span>service/harbor-redis           ClusterIP   10.98.124.114    &lt;none&gt;        6379/TCP                                    15h
</span></span><span style=display:flex><span>service/harbor-registry        ClusterIP   10.100.29.39     &lt;none&gt;        5000/TCP,8080/TCP                           15h
</span></span><span style=display:flex><span>service/harbor-trivy           ClusterIP   10.107.210.23    &lt;none&gt;        8080/TCP                                    15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>deployment.apps/harbor-core            1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>deployment.apps/harbor-jobservice      1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>deployment.apps/harbor-nginx           1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           148m
</span></span><span style=display:flex><span>deployment.apps/harbor-notary-server   1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>deployment.apps/harbor-notary-signer   1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>deployment.apps/harbor-portal          1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>deployment.apps/harbor-registry        1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                              DESIRED   CURRENT   READY   AGE
</span></span><span style=display:flex><span>replicaset.apps/harbor-core-7db5b74c86            <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>replicaset.apps/harbor-jobservice-865b66687b      <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>replicaset.apps/harbor-nginx-5cb465f58f           <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>replicaset.apps/harbor-notary-server-854944cd7d   <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>replicaset.apps/harbor-notary-signer-76b6978d97   <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>replicaset.apps/harbor-portal-d7dbcc46c           <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       15h
</span></span><span style=display:flex><span>replicaset.apps/harbor-registry-d7c5dbf6f         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>1</span>       148m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                               READY   AGE
</span></span><span style=display:flex><span>statefulset.apps/harbor-database   1/1     15h
</span></span><span style=display:flex><span>statefulset.apps/harbor-redis      1/1     15h
</span></span><span style=display:flex><span>statefulset.apps/harbor-trivy      1/1     15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                    STORAGECLASS   REASON   AGE
</span></span><span style=display:flex><span>persistentvolume/pvc-24fc670f-e4f2-435d-8205-55e8681cdaa2   5Gi        RWO            Delete           Bound    harbor/data-harbor-trivy-0               nfs-client              15h
</span></span><span style=display:flex><span>persistentvolume/pvc-54c51073-e463-4337-bce7-4bf218e58e1d   1Gi        RWO            Delete           Bound    harbor/harbor-jobservice                 nfs-client              15h
</span></span><span style=display:flex><span>persistentvolume/pvc-9b0f92ee-439f-4e5b-bb4c-46c51c6a6317   1Gi        RWO            Delete           Bound    harbor/data-harbor-redis-0               nfs-client              15h
</span></span><span style=display:flex><span>persistentvolume/pvc-c3926a2b-eecb-4758-aabf-3d32aeb0dd52   1Gi        RWO            Delete           Bound    harbor/database-data-harbor-database-0   nfs-client              15h
</span></span><span style=display:flex><span>persistentvolume/pvc-eee40456-6920-472a-827c-b9d58179e092   5Gi        RWO            Delete           Bound    harbor/harbor-registry                   nfs-client              15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                                    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span style=display:flex><span>persistentvolumeclaim/data-harbor-redis-0               Bound    pvc-9b0f92ee-439f-4e5b-bb4c-46c51c6a6317   1Gi        RWO            nfs-client     15h
</span></span><span style=display:flex><span>persistentvolumeclaim/data-harbor-trivy-0               Bound    pvc-24fc670f-e4f2-435d-8205-55e8681cdaa2   5Gi        RWO            nfs-client     15h
</span></span><span style=display:flex><span>persistentvolumeclaim/database-data-harbor-database-0   Bound    pvc-c3926a2b-eecb-4758-aabf-3d32aeb0dd52   1Gi        RWO            nfs-client     15h
</span></span><span style=display:flex><span>persistentvolumeclaim/harbor-jobservice                 Bound    pvc-54c51073-e463-4337-bce7-4bf218e58e1d   1Gi        RWO            nfs-client     15h
</span></span><span style=display:flex><span>persistentvolumeclaim/harbor-registry                   Bound    pvc-eee40456-6920-472a-827c-b9d58179e092   5Gi        RWO            nfs-client     15h
</span></span></code></pre></div><p>노드 포트를 사용했기 때문에 <code>[쿠버네티스 노드 ip]:30003</code> 경로를 https를 이용해 들어가보면 다음과 같이 대시보드 화면이 나타나는 것을 확인하실 수 있게 됩니다. 다만, 인증서가 신뢰할 수 없다고는 뜹니다.</p><img src=/posts/images/cncf/harbor/1.png class=center><p>저는 Envoy proxy 서버를 두었기 때문에 제가 가진 도메인과 잘 엮어서 외부에서도 접속 할 수 있게 설정을 마쳤습니다. 하버의 초기 로그인 정보는 ID : admin, PW : Harbor12345 입니다.</p><h2 id=how-to-use>How to use?</h2><p>하버를 설치 해보았으니, 사용법도 익혀봅시다. 공식 문서에서는 <a href=https://goharbor.io/docs/2.8.0/working-with-projects/ target=_blank rel=noopener>Working with project</a> 부분 입니다. 눈치 빠르신 분들은 <a href=https://goharbor.io/docs/2.8.0/working-with-projects/ target=_blank rel=noopener>Harbor administration</a> 파트를 넘어 갔다는 걸 아셨을 텐데, 왠지 양이 많이 뛰어 넘고 싶은 느낌 입니다. 그래도 언젠가 한 번 심도 있게 어떤 기능이 있는지 살펴보긴 해야겠죠? 언젠간 말이에요</p><p>로그인을 하고 나면 다음과 같은 화면이 나타납니다.</p><img src=/posts/images/cncf/harbor/2.png class=center><p><strong>Project</strong></p><p>프로젝트가 생성되지 않으면 이미지를 하버에 저장할 수 없습니다. 프로젝트는 유저의 역할에 따라 사용할 수 있는 기능이 다르다고 하네요. (Role-Based Access Control : RBAC) 또 크게 Public과 Private로 구분된다고 합니다. 디폴트로 library 프로젝트가 만들어져 있습니다.</p><p>저는 지금 관리자의 권한을 가지고 있습니다. 프로젝트를 만들어봅시다. 프로젝트 네임과 quota limit이 필수 기입 조건인데, -1이 의미하는 것은 용량 제한을 두지 않겠다 라는 말입니다.</p><img src=/posts/images/cncf/harbor/3.png class=center><p>위의 상태로 생성을 해보면, 프로젝트가 추가된 게 확인 됩니다. Private로 만들었습니다.</p><img src=/posts/images/cncf/harbor/4.png class=center><p>안에 들어와 보니 summary, repositories, helm charts, members, labels, scanner, p2p preheat, policy, robot accounts, logs 그리고 configuration 탭이 존재 합니다. 기능이 많습니다.</p><img src=/posts/images/cncf/harbor/5.png class=center><p>Configuration 쪽을 클릭해보면, Public 전환 버튼과 취약점이 있을지도 모르는 이미지(Vulnerability image)에 관련된 버튼들이 존재 합니다.</p><img src=/posts/images/cncf/harbor/6.png class=center><p>이제 프로젝트에 유저를 추가해봅시다. 유저를 먼저 만들어 봐야겠죠? Administration에 NEW USER를 클릭합니다. 저는 openstack 이라는 이름으로 하나 만들어 보았습니다. 생성 후 project로 돌아와 Members에서 openstack을 추가 해줍시다. 선택 버튼이 아니라 입력인 것이 조금 이외입니다.</p><img src=/posts/images/cncf/harbor/7.png class=center><p>추후 Role을 바꾼다던가 유저를 프로젝트에서 없애려면 Action 버튼을 활용하면 될 것 같습니다.</p><p>openstack 유저로 로그인 해서 확인해보면, kaps 프로젝트가 리스트에 보이게 됩니다.</p><p>LDAP(?) server을 하버에 연결 시켜 두었다면, 유저에 Group을 형성할 수 있는 듯 한데, 제 하버에는 그런 설정이 되어 있지 않습니다.</p><p>이외에도 프로젝트에서는, Robot 계정을 만들수도 있고, 웹훅 알람을 보낼 수도 있습니다. 자세한 내용은 <a href=https://goharbor.io/docs/2.8.0/working-with-projects/project-configuration/ target=_blank rel=noopener>문서</a>를 참고해봅시다.</p><h3 id=image>Image</h3><p>하버를 HTTP로 사용하거나, 인증서가 unknown CA certificate 일 때 도커 클라이언트에서 이미지를 보낼 수 없다고 합니다. 현재 제 서버가 어느 정도까지 허용 될지 모르겠으니, 우선 image push를 시도해봅시다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo docker image list
</span></span><span style=display:flex><span>REPOSITORY         TAG            IMAGE ID       CREATED        SIZE
</span></span><span style=display:flex><span>envoyproxy/envoy   v1.27-latest   511f8ff2a1f9   <span style=color:#ae81ff>5</span> days ago     147MB
</span></span><span style=display:flex><span>hello-world        latest         9c7a54a9a43c   <span style=color:#ae81ff>2</span> months ago   13.3kB
</span></span></code></pre></div><p>엔보이 프록시 이미지를 하버에 넣어봅시다. 저는 문제 없이 로그인 했습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># docker login &lt;harbor_address&gt;</span>
</span></span><span style=display:flex><span>Username: admin
</span></span><span style=display:flex><span>Password:
</span></span></code></pre></div><p>만약 문제가 생긴다면 <a href=https://goharbor.io/docs/2.8.0/install-config/run-installer-script/#connect-http target=_blank rel=noopener>이 방법</a>을 시도 해봅시다.</p><p>다운 받아두었던 이미지를 tag 명령으로 다음과 같이 바꿔줍시다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># docker tag envoyproxy/envoy:v1.27-latest &lt;harbor_address&gt;/kaps/envoyproxy/envoy:v1.27-latest</span>
</span></span><span style=display:flex><span><span style=color:#75715e># docker image list</span>
</span></span><span style=display:flex><span>REPOSITORY                                TAG            IMAGE ID       CREATED        SIZE
</span></span><span style=display:flex><span>envoyproxy/envoy                          v1.27-latest   511f8ff2a1f9   <span style=color:#ae81ff>5</span> days ago     147MB
</span></span><span style=display:flex><span>&lt;harbor_address&gt;/kaps/envoyproxy/envoy   v1.27-latest   511f8ff2a1f9   <span style=color:#ae81ff>5</span> days ago     147MB
</span></span><span style=display:flex><span>hello-world                               latest         9c7a54a9a43c   <span style=color:#ae81ff>2</span> months ago   13.3kB
</span></span></code></pre></div><p>그리고 바꾼 이미지를 push 합니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker push &lt;harbor_address&gt;/kaps/envoyproxy/envoy:v1.27-latest
</span></span><span style=display:flex><span>The push refers to repository <span style=color:#f92672>[</span>&lt;harbor_address&gt;/kaps/envoyproxy/envoy<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>5f70bf18a086: Pushed 
</span></span><span style=display:flex><span>34049bcf227d: Pushed 
</span></span><span style=display:flex><span>7f9bdb71d8f3: Pushed 
</span></span><span style=display:flex><span>d44ad2051d84: Pushed 
</span></span><span style=display:flex><span>d4dab6f2fcc7: Pushed 
</span></span><span style=display:flex><span>dde1e8ed09f5: Pushed 
</span></span><span style=display:flex><span>c04c5616301c: Pushed 
</span></span><span style=display:flex><span>928c1abc363c: Pushed 
</span></span><span style=display:flex><span>f5bb4f853c84: Pushed 
</span></span><span style=display:flex><span>v1.27-latest: digest: sha256:fdc35b806570985ff51db9736017b76508873581223e5d8df92b3f8ad9c9c489 size: <span style=color:#ae81ff>2195</span>
</span></span></code></pre></div><p>결과는 성공입니다!!!</p><img src=/posts/images/cncf/harbor/8.png class=center><p>가장 근본적이고, 중요한 기능을 동작 해보았습니다.</p><p><a href=https://goharbor.io/docs/2.8.0/working-with-projects/working-with-images/ target=_blank rel=noopener>문서</a>를 보면, 이미지를 다루는 다양한 기능들이 존재하니 언젠가 꼭 살펴 봐야겠습니다.</p><h3 id=api-v20>API V2.0</h3><p>대시보드 좌측 하단에 API 문서 링크가 있습니다. 이 역시 언젠가 마음을 다 잡고 한 번 살펴보는 것이 좋아 보입니다.</p><img src=/posts/images/cncf/harbor/9.png class=center>
<img src=/posts/images/cncf/harbor/10.png class=center></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/Larshavin/Larshavin.github.io/edit/main/content/posts/500.%20Tech_Dev/%ec%bf%a0%eb%b2%84%eb%84%a4%ed%8b%b0%ec%8a%a4%20cncf%20landscape/1_Harbor.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/500.-tech_dev/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B8%B0%EB%B3%B8/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EA%B0%80-%EB%AD%90%EC%A7%802/ title="쿠버네티스가 뭐지 2" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>쿠버네티스가 뭐지 2</div></a></div><div class="col-md-6 next-article"><a href=/posts/500.-tech_dev/kolla-ansible/ title=Kolla-Ansible class="btn filled-button"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Kolla-Ansible</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#installation>Installation</a><ul><li><a href=#dynamic-provisioning--pvc-with-nfs>Dynamic provisioning : pvc with NFS</a></li><li><a href=#valuesyaml>values.yaml</a></li><li><a href=#helm-install>Helm install</a></li></ul></li></ul></li><li><a href=#how-to-use>How to use?</a><ul><li><a href=#image>Image</a></li><li><a href=#api-v20>API V2.0</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://kubesy.com/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://kubesy.com/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://kubesy.com/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://kubesy.com/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://kubesy.com/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:gkdlgkdl2040@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>gkdlgkdl2040@gmail.com</span></a></li><li><a href=tel:+82%20010-4207-5229 target=_blank rel=noopener><span><i class="fas fa-phone-alt"></i></span> <span>+82 010-4207-5229</span></a></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Enter email"><br><input type=hidden name=btr_url value=https://kubesy.com//index.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
<button type=submit class="btn btn-info"> Submit</button></div></form></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2025 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.535eb0f1aa800085b38be4369dadb763d2d3b2c81513f53e0664819331cc8bca.js integrity="sha256-U16w8aqAAIWzi+Q2na23Y9LTssgVE/U+BmSBkzHMi8o=" defer></script></body></html>